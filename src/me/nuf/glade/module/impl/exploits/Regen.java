package me.nuf.glade.module.impl.exploits;

import me.nuf.glade.module.Category;
import me.nuf.glade.module.ToggleableModule;
import me.nuf.glade.properties.EnumProperty;
import me.nuf.glade.subjects.MotionUpdateSubject;
import me.nuf.subjectapi.Listener;
import net.minecraft.network.play.client.C03PacketPlayer;
import net.minecraft.potion.Potion;

/**
 * Created by nuf on 3/20/2016.
 */
public final class Regen extends ToggleableModule {
    private final EnumProperty<Mode> mode = new EnumProperty<>(Mode.Potion, "Mode", "m");

    public Regen() {
        super(new String[]{"Regen", "fastregen", "regeneration"}, true, 0xFF555500, Category.EXPLOITS);
        this.offerProperties(mode);
        this.addListeners(new Listener<MotionUpdateSubject>("regen_motion_update_listener") {
            @Override
            public void call(MotionUpdateSubject subject) {
                if (shouldRegen())
                    switch (mode.getValue()) {
                        case Old:
                            for (int i = 0; i < minecraft.thePlayer.getMaxHealth() - minecraft.thePlayer.getHealth(); i++)
                                minecraft.getNetHandler().addToSendQueue(new C03PacketPlayer(minecraft.thePlayer.onGround));
                            break;
                        case Potion:
                            if (minecraft.thePlayer.isPotionActive(Potion.regeneration))
                                for (int i = 0; i < minecraft.thePlayer.getMaxHealth() - minecraft.thePlayer.getHealth(); i++)
                                    minecraft.getNetHandler().addToSendQueue(new C03PacketPlayer(minecraft.thePlayer.onGround));
                            break;
                    }
            }
        });
        setEnabled(false);
    }

    private boolean shouldRegen() {
        return minecraft.thePlayer.onGround && minecraft.thePlayer.isCollidedVertically && minecraft.thePlayer.getFoodStats().getFoodLevel() > 18
                && !minecraft.thePlayer.isInWater() && !minecraft.thePlayer.isOnLadder() && minecraft.thePlayer.getHealth() < 18;
    }

    public enum Mode {
        Old, Potion
    }
}
