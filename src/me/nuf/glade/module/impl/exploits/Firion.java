package me.nuf.glade.module.impl.exploits;

import me.nuf.api.minecraft.BlockHelper;
import me.nuf.glade.module.Category;
import me.nuf.glade.module.ToggleableModule;
import me.nuf.glade.properties.Property;
import me.nuf.glade.subjects.MotionUpdateSubject;
import me.nuf.subjectapi.Listener;
import net.minecraft.network.play.client.C03PacketPlayer;
import net.minecraft.potion.Potion;

/**
 * Created by nuf on 3/28/2016.
 */
public final class Firion extends ToggleableModule {
    private final Property<Boolean> looping = new Property<>(true, "Looping", "loop", "l");

    private final Potion[] effects = {Potion.moveSlowdown, Potion.digSlowdown, Potion.harm, Potion.hunger, Potion.weakness,
            Potion.poison, Potion.wither};

    public Firion() {
        super(new String[]{"Firion", "zoot", "antipotion"}, true, 0xFFED3B3E, Category.EXPLOITS);
        this.offerProperties(looping);
        this.addListeners(new Listener<MotionUpdateSubject>("firion_motion_update_listener") {
            @Override
            public void call(MotionUpdateSubject subject) {
                if (minecraft.thePlayer.isPotionActive(Potion.blindness))
                    minecraft.thePlayer.removePotionEffect(Potion.blindness.id);
                if (minecraft.thePlayer.isPotionActive(Potion.confusion))
                    minecraft.thePlayer.removePotionEffect(Potion.confusion.id);
                if (looping.getValue()) {
                    if (minecraft.thePlayer.onGround && !BlockHelper.isInLiquid(minecraft.thePlayer)
                            && !BlockHelper.isOnLiquid(minecraft.thePlayer)) {
                        for (Potion effect : effects)
                            if (minecraft.thePlayer.isPotionActive(effect))
                                loop();
                        if (minecraft.thePlayer.isBurning() && !minecraft.thePlayer.isPotionActive(Potion.fireResistance))
                            loop();
                    }
                }
            }
        });
    }

    private void loop() {
        for (int a = 0; a <= 20; a++)
            minecraft.getNetHandler().addToSendQueue(new C03PacketPlayer(minecraft.thePlayer.onGround));
    }
}
